# 英文構文解析・強調表示 Web アプリ - ロードマップ

## フェーズ1: 環境構築とUIの基盤構築

### 目標
アプリケーションの実行環境を確立し、基本的なUIコンポーネントを配置する。

### 主要タスク
*   プロジェクトリポジトリの作成と初期コミット
*   `requirements.txt` に `streamlit` と `spacy` を追加
*   `app.py` ファイルの作成とStreamlitアプリの初期起動確認
*   spaCy英語モデルのダウンロードコマンドの実行 (`python -m spacy download en_core_web_sm`)
*   UIのスケルトン作成:
    *   `st.text_area` で英文入力ボックスを配置
    *   `st.button` で「解析実行」ボタンと「クリア」ボタンを配置
    *   `st.empty` または `st.markdown` で解析結果表示用のプレースホルダーを配置
*   `st.session_state` を利用して、入力テキストや解析結果の状態を管理する準備
*   **入力のバリデーションとフィードバックの初期実装（空入力チェック、簡単な英文判定）**
*   **オンボーディングとヘルプ機能の初期実装（簡単な説明表示、サンプル英文のデフォルト表示）**

### 受け入れ基準
*   Streamlitアプリが正常に起動し、基本的なUI要素が表示されること。
*   `requirements.txt` に記載されたライブラリがインストールされ、spaCyモデルがダウンロードされていること。
*   入力が空の場合に警告メッセージが表示されること。
*   初回アクセス時に簡単な説明が表示され、サンプル英文が入力エリアに表示されること。

## フェーズ2: 英文解析ロジックの実装

### 目標
入力された英文を解析し、主語、動詞、各種句を正確に特定する中核ロジックを開発する。

### 主要タスク
*   spaCyモデルのロードロジックの実装 (`st.cache_resource` を利用してアプリ起動時に一度だけロード)
*   `SentenceAnalyzer` クラス/関数のスケルトン作成
*   入力テキストをspaCyで処理し、`Doc`オブジェクトを生成する関数を作成
*   `Doc`オブジェクトから名詞句 (`doc.noun_chunks`) と動詞句を識別するロジックを実装
*   `Doc`オブジェクトから主語 (`token.dep_ == 'nsubj'`) と動詞 (`token.pos_ == 'VERB'`) を特定するロジックを実装
*   解析結果を構造化されたデータ（例: 辞書やリスト）として返すように実装
*   **複数文の分割と各文の解析ロジックを実装**
*   **複雑な構文パターン（関係代名詞節、分詞構文、不定詞句、動名詞句、比較構文など）への対応ロジックを実装**
*   **SentenceAnalyzer のユニットテストを作成**

### 受け入れ基準
*   一般的な英文において、主語と動詞を90%以上の精度で、名詞句、動詞句、前置詞句を80%以上の精度で正確に識別できること。
*   解析処理が、入力されたテキストの長さにもよるが、数秒以内（例: 100文字あたり1秒以内）に完了し、結果が表示されること。
*   複数文が入力された場合でも、各文が適切に解析され、結果が返されること。
*   主要な複雑な構文パターンが正しく解析されること。
*   SentenceAnalyzer の主要な機能がユニットテストでカバーされ、期待通りに動作すること。

## フェーズ3: 解析結果の視覚化とUI/UX改善

### 目標
解析結果をユーザーに分かりやすく視覚的に表示し、アプリケーションの使いやすさを向上させる。

### 主要タスク
*   `ResultFormatter` クラス/関数のスケルトン作成
*   主語と動詞を色付けするHTML/Markdown生成ロジックの実装
*   句を括弧で囲むHTML/Markdown生成ロジックの実装
*   生成されたHTML/Markdownを `st.markdown(..., unsafe_allow_html=True)` で表示
*   複数の句が入れ子になる場合の表示ロジックの検討と実装
*   「解析実行」ボタンクリック時の処理フローを実装 (入力取得 -> 解析 -> 結果整形 -> 表示)
*   「クリア」ボタンクリック時の処理フローを実装 (入力エリアと結果表示をクリア)
*   解析中のローディング表示 (`st.spinner`)
*   無効な入力（空文字列など）に対するエラーメッセージ表示
*   解析に失敗した場合のユーザーフレンドリーなメッセージ表示
*   UI/UXの調整 (Streamlitの標準機能範囲内で、視覚的な改善)
*   レスポンシブデザインの確認 (PCとスマートフォンでの表示崩れがないか)
*   **句のネスト（入れ子構造）を考慮した括弧表示ロジックの実装**
*   **色付け以外の強調スタイル（太字、下線、背景色など）を適用するロジックを実装**
*   **インタラクティブな表示（マウスオーバー時のツールチップなど）の検討と実装**
*   **表示オプション（表示レベル、元の文との切り替え）の実装**
*   **解析結果のダウンロード機能（HTML, TXT, JSON形式）の実装**
*   **アクセシビリティ（色覚多様性対応など）の考慮と実装**
*   **フィードバックメッセージの強化（解析完了メッセージ、より分かりやすいエラーメッセージ）**
*   **ResultFormatter のユニットテストを作成**

### 受け入れ基準
*   解析結果が元の英文と対応付けられ、視覚的に分かりやすく表示されること。主語と動詞の色付けが明確で、視認性が高いこと。句の括弧表示が正確で、入れ子構造も正しく表現されること。
*   アプリケーションの応答性が高く、操作がスムーズであること。
*   クリア/リセット機能が瞬時に動作し、入力と表示が完全に初期化されること。
*   句のネスト構造が視覚的に分かりやすく表現されること。
*   ユーザーが強調スタイルや表示オプションをある程度制御できること。
*   基本的なインタラクティブ機能が動作すること。
*   解析結果を異なる形式でダウンロードできること。
*   様々なデバイスでレイアウトが崩れず、アクセシビリティが考慮されていること。
*   ユーザーへのフィードバックが明確で分かりやすいこと。
*   ResultFormatter の主要な機能がユニットテストでカバーされ、期待通りに動作すること。

## フェーズ4: 統合、テスト、デプロイ

### 目標
全てのコンポーネントを統合し、徹底的なテストを行い、アプリケーションを公開する。

### 主要タスク
*   各コンポーネントの統合と連携確認
*   様々な英文パターン（短文、長文、複雑な構文）でのテスト
*   主語、動詞、句の特定精度に関するテストと改善
*   パフォーマンス測定とボトルネックの特定、改善 (100文字程度の英文であれば、解析から表示まで3秒以内に完了すること)
*   `requirements.txt` の最終化 (必要なライブラリとそのバージョンを正確に記載)
*   Streamlit Community Cloud もしくは他のホスティングサービスへのデプロイ手順を確認し、実行
*   **長文解析時のパフォーマンス最適化（非同期処理、部分的な解析結果の表示など）の検討と実装**
*   **モジュール化されたコードの最終レビューとリファクタリング**
*   **静的解析ツールによるコード品質チェックの実施**
*   **結合テストの実施**

### 受け入れ基準
*   直感的で、初めてのユーザーでも迷わず利用できること。
*   任意の長さの英文（例: 500文字以内）を正確に入力・表示できること。
*   アプリケーションが安定して動作し、エラーなくデプロイできること。
*   長文が入力された場合でも、許容範囲内の時間で解析・表示が完了すること。
*   コードがモジュール化され、保守性が高いこと。
*   静的解析ツールで指摘される問題がないこと。
*   主要な機能が結合テストで確認されていること。