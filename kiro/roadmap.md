

### 英文構造解析アプリ再開発ロードマップ

**最終目標:** spaCyとStreamlitを使用し、入力された英文の構造を視覚的に解析する、インタラクティブで教育的なWebアプリケーションを構築する。学習者が英文の構造を直感的に理解できるよう、段階的な情報提示と高度な視覚化機能を提供する。

---

**更新日: 2025年7月21日月曜日**

---

### フェーズ1: MVP (Minimum Viable Product) の構築 (完了済み)

**ゴール:** 品詞タグ（粗い粒度）の色分け表示、主語-動詞の依存関係の矢印表示、簡単な解説ポップアップを実装し、コアとなる価値を迅速に提供する。

1.  **環境構築と基本設定:**
    *   `requirements.txt`の更新: `streamlit`, `spacy`, `graphviz` を追記。
    *   spaCyモデルのダウンロード: `en_core_web_sm` モデルをダウンロードするロジックを実装 (`@st.cache_resource` を使用)。
    *   Streamlitアプリの基本構造: `app.py`にタイトル、テキスト入力エリア、解析実行ボタンを配置。
2.  **基本解析機能の実装 (`analyze_sentence`):**
    *   入力テキストをspaCyで処理し、`TokenInfo` と `ChunkInfo` のデータモデルに従って解析結果を構造化データとして返す関数を実装する。
    *   **抽出情報:**
        *   **TokenInfo:** `id`, `text`, `lemma`, `pos_`, `tag_`, `dep`, `head_id`, `children_ids`, `is_root`
        *   **ChunkInfo (NP, VP, PP, ADVP):** `doc.noun_chunks` を利用して名詞句を抽出。動詞句、前置詞句、副詞句は依存関係ツリーを探索するロジックで抽出。
3.  **UI/UXの実装 (MVPレベル):**
    *   **品詞表示 (デフォルト/詳細):** `display_tokens_default` と `display_tokens_detailed` を実装し、品詞 (pos) ごとに色分けされた単語を表示。詳細表示ではポップオーバーで詳細情報を表示。
    *   **依存関係ツリー表示:** `display_dependency_tree` を実装し、Graphvizを用いて依存関係ツリーを表示する。
        *   **強調:** ROOT単語とnsubj（名詞主語）を`salmon`色で強調。nsubjエッジは両方向矢印。nsubj修飾語（det, amodなど）はnsubjの左側に配置。
    *   **句構造のハイライト表示:** `display_chunks` を実装し、句の種類に応じて背景色を変えてハイライト表示する。
    *   **解説機能:** サイドバーに品詞、句構造、依存関係の解説を追加。
    *   **UI制御:** `st.spinner` で解析中のフィードバックを提示。`st.checkbox` で詳細表示のON/OFFを切り替え。複数文の解析結果表示に対応。

---

### フェーズ2: 句構造の階層的表示の実現 (優先度: 高)

**ゴール:** 句の中にさらに句が含まれるような階層構造を視覚的に表現し、より複雑な文の構造理解を支援する。

1.  **インデントによる階層表現の実装:**
    *   テキスト表示において、ネストされた句をインデントで表現するロジックを `display_chunks` 関数に組み込む。
2.  **ネストされたボックスによる視覚化の検討:**
    *   HTML/CSSを用いて、親の句の背景ボックスの中に子となる句の背景ボックスを配置する視覚的表現を検討・実装する。
3.  **句構造専用ツリーの導入検討:**
    *   依存関係ツリーとは別に、句構造の階層を明確に示す専用のツリー構造（例: 構文木）をGraphvizなどで表現することを検討する。

---

### フェーズ3: 品詞タグの精度と粒度の向上 (優先度: 中)

**ゴール:** より専門的なテキストや特定の言語現象に対応するため、品詞タグの精度と柔軟性を高める。

1.  **より高精度なspaCyモデルの調査・導入:**
    *   `en_core_web_lg` や `en_core_web_trf` など、より大規模で高精度なspaCyモデルの導入を検討し、解析結果の比較を行う。
2.  **カスタム品詞タグの検討・実装:**
    *   特定の解析ニーズに合わせて、既存の品詞タグをさらに細分化したり、新しい品詞タグを定義したりする可能性を検討する。

---

### フェーズ4: 全体的な品質向上と最適化 (優先度: 低〜中)

**ゴール:** アプリケーションの安定性、パフォーマンス、ユーザー体験をさらに向上させる。

1.  **レスポンシブデザインの確認と調整:**
    *   異なる画面サイズ（デスクトップ、タブレット、モバイル）での表示崩れがないかを確認し、必要に応じてCSSを調整する。
2.  **CSSによる表示スタイルの微調整:**
    *   現在の色使いやレイアウトをさらに洗練させ、より見やすく、使いやすいUI/UXを目指す。
3.  **様々な英文パターンでのテスト（継続）:**
    *   短文、長文、複雑な構文、口語表現など、多様な英文での解析精度と表示の正確性を継続的にテストする。
4.  **パフォーマンス測定とボトルネックの特定、改善:**
    *   大量のテキストや非常に複雑な文を解析する際の処理速度を測定し、ボトルネックがあれば`analyzer.py`のロジックやspaCyモデルの選択を見直す。
5.  **`requirements.txt` の最終化:**
    *   開発中に導入されたすべてのライブラリが`requirements.txt`に正確に記述されているか最終確認する。
6.  **Streamlit Community Cloud へのデプロイ:**
    *   アプリケーションを公開し、広く利用してもらえるようにする。
